# C:\startup\disk-setup.ps1

$uninitializedDisks = Get-Disk | Where-Object { $_.PartitionStyle -eq 'RAW' }

foreach ($disk in $uninitializedDisks) {
    Initialize-Disk -Number $disk.Number -PartitionStyle GPT -PassThru |
    New-Partition -UseMaximumSize -AssignDriveLetter |
    Format-Volume -FileSystem NTFS -NewFileSystemLabel "DataDisk" -Confirm:$false
}

# If D: is not in use, reassign the newly formatted disk to D:
$vols = Get-Volume | Where-Object { $_.FileSystemLabel -eq "DataDisk" }
foreach ($vol in $vols) {
    if ((Get-Volume -DriveLetter D -ErrorAction SilentlyContinue) -eq $null) {
        Set-Partition -DriveLetter $vol.DriveLetter -NewDriveLetter D
    }
}