pipeline {
    agent any
    environment {
        IMAGE_FAMILY = 'your-image-family'
        IMAGE_PROJECT = 'your-image-project'
        MIG_NAME = 'your-mig-name'
        MIG_ZONE = 'your-mig-zone'
    }
    stages {
        stage('Check GCP Image') {
            steps {
                script {
                    def result = sh(
                        script: """
                            gcloud compute images list --filter="family:${IMAGE_FAMILY}" --project=${IMAGE_PROJECT} --format="get(name)" --limit=1
                        """,
                        returnStdout: true
                    ).trim()
                    if (result) {
                        echo "An image exists in the family ${IMAGE_FAMILY}."
                    } else {
                        error "No image found in the family ${IMAGE_FAMILY}."
                    }
                }
            }
        }
        stage('Resize MIG to 0') {
            steps {
                script {
                    sh """
                        gcloud compute instance-groups managed resize ${MIG_NAME} --zone ${MIG_ZONE} --size 0
                    """
                }
            }
        }
        stage('Resize MIG to 1') {
            steps {
                script {
                    sh """
                        gcloud compute instance-groups managed resize ${MIG_NAME} --zone ${MIG_ZONE} --size 1
                    """
                }
            }
        }
    }
}
